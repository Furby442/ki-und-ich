---
phase: 02-kiki-maskottchen-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/kiki/kiki-avatar.js
  - src/components/kiki/kiki.js
  - assets/styles/kiki.css
  - index.html
autonomous: true

must_haves:
  truths:
    - "Kiki SVG appears in bottom-left corner of every page"
    - "Kiki displays 6 distinct emotions (happy, thoughtful, proud, sad, surprised, curious)"
    - "Kiki has idle animations (floating, antenna sway, blinking)"
    - "Animations respect prefers-reduced-motion preference"
  artifacts:
    - path: "src/components/kiki/kiki-avatar.js"
      provides: "SVG generation with emotion support"
      exports: ["KikiAvatar", "EMOTIONS"]
    - path: "src/components/kiki/kiki.js"
      provides: "Kiki controller with state management"
      exports: ["Kiki", "kikiInstance"]
    - path: "assets/styles/kiki.css"
      provides: "Kiki styling and animations"
      contains: "@keyframes kiki-float"
  key_links:
    - from: "src/components/kiki/kiki.js"
      to: "src/components/kiki/kiki-avatar.js"
      via: "import KikiAvatar"
      pattern: "import.*KikiAvatar.*from"
    - from: "assets/styles/kiki.css"
      to: "SVG elements"
      via: "data-emotion attribute selectors"
      pattern: "\\[data-emotion="
---

<objective>
Create the core Kiki mascot SVG component with emotion system and idle animations.

Purpose: Kiki is the friendly robot guide who makes AI tangible for children. This plan establishes the visual foundation - the SVG avatar with 6 emotions and smooth animations.

Output: KikiAvatar component generating inline SVG, Kiki controller class for state management, and CSS animations for emotions and idle states.
</objective>

<execution_context>
@C:\Users\Furby\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Furby\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-kiki-maskottchen-system/02-CONTEXT.md
@.planning/phases/02-kiki-maskottchen-system/02-RESEARCH.md
@src/app.js
@src/views/home.js
@assets/styles/main.css
@assets/styles/components.css
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Kiki SVG Avatar Component</name>
  <files>
    - src/components/kiki/kiki-avatar.js
  </files>
  <action>
Create the KikiAvatar component following existing codebase patterns (function returning HTML string).

The SVG must include:
- Robot body: Purple/violet (#8B5CF6) box with rounded corners, floating (no legs)
- Head: Slightly smaller box above body with rounded corners
- LED eyes: Two rectangular displays with cyan color (#22D3EE), can show emotion symbols
- Mouth: Simple SVG path that transforms between emotions
- Antenna: Single antenna with glowing tip, transform-origin at base for swaying
- Arms: Segmented robot arms with 3-finger hands (circles for simplicity)

Key implementation details:
- viewBox="0 0 150 200" for consistent scaling
- Use CSS custom properties for colors (--kiki-primary, --kiki-secondary, etc.)
- Apply data-emotion attribute to root SVG for CSS emotion targeting
- Group elements logically (.kiki-root, .kiki-antenna, .kiki-eyes, .kiki-mouth, .kiki-arms)
- Include role="img" and aria-label for accessibility
- Default size: 150px width (from CONTEXT: 120-150px)

Export EMOTIONS constant with: HAPPY, THOUGHTFUL, PROUD, SAD, SURPRISED, CURIOUS
  </action>
  <verify>
File exists at src/components/kiki/kiki-avatar.js. Import and call KikiAvatar() in browser console returns valid SVG string containing viewBox, data-emotion, and all body part class names.
  </verify>
  <done>
KikiAvatar function generates complete robot SVG with all parts (body, head, eyes, mouth, antenna, arms) and EMOTIONS constant is exported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Kiki CSS Animations and Emotion Styles</name>
  <files>
    - assets/styles/kiki.css
    - index.html
  </files>
  <action>
Create comprehensive Kiki stylesheet following existing CSS architecture patterns.

CSS Variables (add to :root):
- --kiki-primary: #8B5CF6 (main purple)
- --kiki-secondary: #A78BFA (lighter purple)
- --kiki-accent: #F59E0B (orange glow for antenna)
- --kiki-screen: #22D3EE (cyan LED)
- --kiki-screen-dim: #155E75 (body panel)
- --kiki-timing-slow: 0.8s
- --kiki-timing-normal: 0.4s
- --kiki-easing: cubic-bezier(0.4, 0, 0.2, 1)

Container positioning:
- .kiki-container: position fixed, bottom: 80px (above nav), left: 16px, z-index: 900

Idle animations (from RESEARCH):
- @keyframes kiki-float: translateY 0 to -6px over 3s
- @keyframes kiki-antenna-sway: rotate -3deg to 3deg over 4s
- @keyframes kiki-blink: scaleY 1 to 0.1 at 95% over 4s
- @keyframes kiki-glow: drop-shadow 2px to 8px over 2s (antenna tip)

Emotion states (use [data-emotion="X"] selectors):
- happy: smile curve (d path change), rounded eyes
- thoughtful: raised eyebrow (eye translate), flat mouth, antenna tilted 15deg
- proud: big smile, eyes squinted (scaleY 0.7), body slightly larger
- sad: frown, droopy antenna (30deg), eyes lowered
- surprised: wide eyes (scale 1.3), O-shaped mouth, fast antenna glow
- curious: head tilted (-5deg), one eye bigger, asymmetric mouth

Reduced motion support:
- @media (prefers-reduced-motion: reduce) - disable all decorative animations
- Keep state transitions but make them instant (0.1s)

Mobile responsive:
- @media (max-width: 599px): smaller size (100px width), adjusted positioning

Add kiki.css to index.html after components.css link.
  </action>
  <verify>
File exists at assets/styles/kiki.css. Opening index.html shows kiki.css linked. CSS contains all 6 emotion selectors and 4 idle animation keyframes. DevTools Elements panel shows kiki.css loaded without errors.
  </verify>
  <done>
Kiki CSS file contains all emotion states, idle animations, positioning, and accessibility support. Stylesheet is linked in index.html.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Kiki Controller and Global Integration</name>
  <files>
    - src/components/kiki/kiki.js
    - src/app.js
  </files>
  <action>
Create Kiki controller class that manages the mascot globally across all views.

Kiki class implementation:
- Constructor: Create kiki-container div, append to body, render KikiAvatar
- init(): Called once from app.js, inserts Kiki container into DOM
- setEmotion(emotion): Updates data-emotion attribute on SVG
- getEmotion(): Returns current emotion
- prefersReducedMotion: Check matchMedia and listen for changes

Export singleton instance (kikiInstance) that app.js will initialize.

In app.js:
- Import { kikiInstance } from './components/kiki/kiki.js'
- After router initialization, call kikiInstance.init()
- Make available globally: window.kiki = kikiInstance (for debugging and view access)

Integration pattern:
- Kiki renders ONCE in body, persists across route changes
- Views can access window.kiki.setEmotion() to change Kiki's state
- Container uses position:fixed so it floats independent of #app content
  </action>
  <verify>
Run app locally. Kiki appears in bottom-left corner on all pages (home, lesson/1, quiz/1). Browser console: window.kiki.setEmotion('surprised') changes Kiki's expression. window.kiki.getEmotion() returns current emotion.
  </verify>
  <done>
Kiki controller manages global mascot state. Kiki SVG appears on every page. Emotion can be changed programmatically via window.kiki.setEmotion().
  </done>
</task>

</tasks>

<verification>
Overall Phase Verification:
1. Navigate to home page - Kiki visible in bottom-left
2. Navigate to lesson/1 - Kiki still visible (same instance, not re-rendered)
3. Navigate to quiz/1 - Kiki still visible
4. Open DevTools, run: window.kiki.setEmotion('happy') - Kiki smiles
5. Run: window.kiki.setEmotion('sad') - Kiki frowns, antenna droops
6. Run: window.kiki.setEmotion('proud') - Kiki beams, body enlarges slightly
7. Run: window.kiki.setEmotion('surprised') - Kiki's eyes go wide
8. Run: window.kiki.setEmotion('curious') - Kiki tilts head
9. Run: window.kiki.setEmotion('thoughtful') - Kiki looks contemplative
10. Observe idle animations: floating, antenna swaying, occasional blinking
11. In DevTools, toggle "Emulate CSS media feature prefers-reduced-motion" - animations stop
12. Mobile view (DevTools responsive): Kiki smaller but still visible above nav
</verification>

<success_criteria>
- Kiki SVG renders on every page without re-mounting on navigation
- All 6 emotions visually distinct and transition smoothly (0.8s)
- Idle animations run continuously when not in reduced motion mode
- prefers-reduced-motion disables decorative animations
- Kiki positioned bottom-left, above navigation bar, not overlapping content
- window.kiki API available for emotion control
</success_criteria>

<output>
After completion, create `.planning/phases/02-kiki-maskottchen-system/02-01-SUMMARY.md`
</output>
