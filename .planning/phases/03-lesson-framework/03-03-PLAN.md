---
phase: 03-lesson-framework
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - assets/styles/lesson.css
  - src/views/lesson.js
  - index.html
autonomous: false

must_haves:
  truths:
    - "Lesson text is readable by 7-year-olds (22-26px font size)"
    - "User can navigate through all 5 screens of Lesson 1"
    - "Kiki provides guidance on each screen"
    - "Lesson renders correctly on mobile, tablet, and desktop"
  artifacts:
    - path: "assets/styles/lesson.css"
      provides: "Child-friendly typography and lesson layout"
      contains: "--lesson-font-size-text: 22px"
    - path: "src/views/lesson.js"
      provides: "Updated lesson view using LessonRenderer"
      exports: ["LessonView"]
  key_links:
    - from: "src/views/lesson.js"
      to: "src/components/lesson/lesson-renderer.js"
      via: "import LessonRenderer"
      pattern: "new LessonRenderer"
    - from: "src/views/lesson.js"
      to: "src/data/lesson-loader.js"
      via: "import loadLesson"
      pattern: "await loadLesson"
    - from: "index.html"
      to: "lesson.css"
      via: "link stylesheet"
      pattern: "lesson\\.css"
---

<objective>
Add child-friendly lesson CSS, update lesson view to use LessonRenderer, and verify integration.

Purpose: Complete the lesson framework by wiring everything together.
Output: Working lesson experience where users can navigate through screens with Kiki guidance.
</objective>

<execution_context>
@C:\Users\Furby\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Furby\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-lesson-framework/03-RESEARCH.md

Dependencies from this phase:
- 03-01: lesson-loader.js and lesson-1.json
- 03-02: LessonRenderer and renderScreen

Existing files to update:
- src/views/lesson.js (placeholder exists)
- index.html (add CSS link)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create lesson.css with child-friendly typography</name>
  <files>assets/styles/lesson.css</files>
  <action>
Create CSS for lesson display with typography optimized for 7-year-old readers.

Create `assets/styles/lesson.css` with the following sections:

1. **CSS Variables for child-friendly typography:**
```css
:root {
  --lesson-font-size-heading: 28px;
  --lesson-font-size-text: 22px;
  --lesson-font-size-subtext: 18px;
  --lesson-font-size-bullet: 20px;
  --lesson-line-height-heading: 1.3;
  --lesson-line-height-text: 1.6;
  --lesson-letter-spacing: 0.02em;
  --lesson-word-spacing: 0.05em;
}
```

2. **Typography classes:**
- `.lesson-heading`: 28px, bold, centered, primary color
- `.lesson-text`: 22px, 1.6 line-height, centered, max-width 600px
- `.lesson-subtext`: 18px, secondary color
- `.lesson-bullets`: No list-style, custom colored circle bullets

3. **Layout:**
- `.lesson-renderer`: Flex column, min-height calc(100vh - 160px)
- `.lesson-screen-container`: Flex center, overflow hidden
- `.lesson-screen`: Max-width 700px, transition for animations
- `.lesson-screen-content`: Flex column, centered, white background, rounded corners

4. **Screen transitions:**
- `.lesson-screen--exit-next`: translateX(-30px), opacity 0
- `.lesson-screen--exit-prev`: translateX(30px), opacity 0
- `.lesson-screen--enter-next`: translateX(30px), opacity 0
- `.lesson-screen--enter-prev`: translateX(-30px), opacity 0

5. **Progress bar:**
- `.lesson-progress`: Flex row with gap
- `.lesson-progress-bar`: Full width, 10px height, rounded
- `.lesson-progress-fill`: Primary color fill, width transition

6. **Navigation:**
- `.lesson-screen-nav`: Flex space-between, fixed bottom or in flow
- `.lesson-nav-btn`: 48px+ height (touch target), bold, rounded
- `.lesson-nav-btn--prev`: Secondary style, disabled state
- `.lesson-nav-btn--next`: Primary green, "Quiz starten" on last screen

7. **Interactive choices:**
- `.lesson-choices`: Flex column gap
- `.lesson-choice`: Full width button, 48px+ height, border
- `.lesson-choice:hover`: Border color change, slight lift
- `.lesson-choice--correct`: Green background
- `.lesson-choice--incorrect`: Yellow/orange background

8. **Illustrations:**
- `.lesson-illustration`: Max-width 200px, centered, object-fit contain

9. **Responsive:**
- @media (max-width: 599px): Reduce font sizes, hide nav text
- @media (prefers-reduced-motion): Disable transforms

Copy the full CSS from 03-RESEARCH.md Pattern 4, adapting if needed.
  </action>
  <verify>
File exists at assets/styles/lesson.css with:
- Typography variables defined
- All lesson-* classes present
- Touch target sizes >= 48px
- Responsive breakpoints
- Reduced motion support
  </verify>
  <done>Child-friendly lesson CSS with typography, layout, and responsive styles</done>
</task>

<task type="auto">
  <name>Task 2: Update lesson.js view to use LessonRenderer</name>
  <files>src/views/lesson.js</files>
  <action>
Replace the placeholder lesson view with actual LessonRenderer integration.

Update `src/views/lesson.js`:

1. Update imports:
```javascript
import { Navigation } from '../components/navigation.js';
import { LessonRenderer } from '../components/lesson/lesson-renderer.js';
import { loadLesson } from '../data/lesson-loader.js';
```

2. Keep LESSON_TITLES constant (already exists)

3. Make LessonView async:
```javascript
export async function LessonView(container, state, params) {
```

4. Implementation flow:
   a. Parse lessonId from params
   b. Show loading state initially (simple HTML)
   c. Try to load lesson data with loadLesson(lessonId)
   d. On success: Create LessonRenderer, call render()
   e. On error: Show error message with back link

5. Loading state HTML:
```html
<div class="container lesson-page">
  <header class="lesson-header">
    <div class="lesson-badge">Lektion {id}</div>
    <h1>{title}</h1>
  </header>
  <main class="lesson-content">
    <div class="loading-message">
      <p>Lektion wird geladen...</p>
    </div>
  </main>
</div>
```

6. After successful load:
   - Select `.lesson-content` element
   - Clear its innerHTML
   - Create `new LessonRenderer(contentArea, lessonData, state)`
   - Call `renderer.render()`

7. Error handling:
   - Log error to console
   - Show user-friendly error message in German
   - Include link back to home

8. Remove the old Navigation component from the bottom (LessonRenderer has its own nav)

9. Keep the Kiki emotion setting on view load (LessonRenderer will override per screen)
  </action>
  <verify>
File updated at src/views/lesson.js with:
- Imports for LessonRenderer and loadLesson
- Async function
- Loading state shown initially
- LessonRenderer instantiated and rendered
- Error handling with user message
  </verify>
  <done>Lesson view connected to LessonRenderer with loading and error states</done>
</task>

<task type="auto">
  <name>Task 3: Add lesson.css to index.html and test integration</name>
  <files>index.html</files>
  <action>
Add the lesson CSS stylesheet to index.html.

1. Read current index.html
2. Add stylesheet link after existing CSS links:
```html
<link rel="stylesheet" href="assets/styles/lesson.css">
```

Place it after kiki.css (or as the last stylesheet).

3. Verify the CSS load order is correct:
   - main.css (base variables)
   - layout.css (utilities)
   - components.css (patterns)
   - kiki.css (mascot)
   - lesson.css (lesson framework)
  </action>
  <verify>
index.html contains:
- `<link rel="stylesheet" href="assets/styles/lesson.css">`
- Link appears after other stylesheets
  </verify>
  <done>Lesson CSS linked in index.html</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete lesson framework with navigation and Kiki integration</what-built>
  <how-to-verify>
1. Open the app in browser (local server or deployed)
2. Click on "Lektion 1: Was ist KI?" from home page
3. Verify:
   - Loading message appears briefly, then content loads
   - Screen 1 shows intro with heading "Was ist KI?"
   - Progress bar shows "1 / 5"
   - Kiki shows "curious" emotion and speaks greeting
   - "Zurueck" button is disabled on first screen
4. Click "Weiter" to advance:
   - Screen transitions smoothly (slide animation)
   - Progress updates to "2 / 5"
   - Kiki emotion changes per screen
5. Navigate through all 5 screens:
   - Screen 4 has interactive choices - click one
   - Visual feedback appears (green/yellow)
   - Kiki reacts to answer
6. On screen 5:
   - Button text shows "Quiz starten"
   - Clicking navigates to quiz page
7. Test responsive:
   - Resize browser to mobile width
   - Text remains readable (not tiny)
   - Navigation buttons still touch-friendly
8. Test touch (if on tablet/phone):
   - Swipe left = next screen
   - Swipe right = previous screen
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. CSS file loads without 404
2. Lesson 1 loads and displays content
3. Navigation works in all directions
4. Kiki responds to screen changes
5. Interactive choices work with feedback
6. Responsive layout on mobile/tablet
</verification>

<success_criteria>
- User can navigate through all 5 screens of Lesson 1
- Text is large and readable (22px+ on desktop)
- Kiki emotion and messages match each screen
- Progress bar updates correctly
- Touch swipe navigation works
- Quiz button appears on last screen
- No console errors during navigation
</success_criteria>

<output>
After completion, create `.planning/phases/03-lesson-framework/03-03-SUMMARY.md`
</output>
