---
phase: 01-foundation-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - .nojekyll
  - assets/styles/main.css
  - assets/styles/layout.css
  - assets/styles/components.css
  - src/services/router.js
  - src/services/state.js
  - src/app.js
autonomous: true

must_haves:
  truths:
    - "App loads in browser without errors"
    - "Hash-based routing responds to URL changes"
    - "State persists to LocalStorage"
    - "CSS variables define design system"
  artifacts:
    - path: "index.html"
      provides: "SPA shell with viewport meta tag"
      contains: "viewport"
    - path: "src/services/router.js"
      provides: "Hash-based navigation"
      exports: ["Router"]
    - path: "src/services/state.js"
      provides: "LocalStorage state management"
      exports: ["StateManager"]
    - path: "src/app.js"
      provides: "Application entry point"
      contains: "Router"
    - path: "assets/styles/main.css"
      provides: "CSS variables for theming"
      contains: "--color-primary"
  key_links:
    - from: "index.html"
      to: "src/app.js"
      via: "script module import"
      pattern: "type=\"module\".*src/app.js"
    - from: "src/app.js"
      to: "src/services/router.js"
      via: "ES6 import"
      pattern: "import.*Router"
---

<objective>
Create the foundational project structure with HTML shell, CSS design system, hash-based router, and LocalStorage state manager.

Purpose: Establishes the technical foundation for all future features. Without this, nothing else can be built.
Output: A working SPA shell that handles routing and state persistence, styled with Duolingo-inspired design tokens.
</objective>

<execution_context>
@C:\Users\Furby\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Furby\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-setup/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project scaffolding with HTML shell and CSS design system</name>
  <files>
    index.html
    .nojekyll
    assets/styles/main.css
    assets/styles/layout.css
    assets/styles/components.css
  </files>
  <action>
    Create the folder structure exactly as specified in 01-RESEARCH.md:
    - root/index.html (SPA shell)
    - root/.nojekyll (empty file - disables Jekyll on GitHub Pages)
    - root/assets/styles/ (CSS files)
    - root/src/views/ (empty for now)
    - root/src/components/ (empty for now)
    - root/src/services/ (empty for now)
    - root/data/ (empty for now)

    index.html must include:
    - DOCTYPE html with lang="de" (German educational app)
    - Meta viewport tag: width=device-width, initial-scale=1
    - Title: "KI und ich - Lerne Kuenstliche Intelligenz"
    - Preload for main.css
    - Link tags for all three CSS files
    - Single div#app container for SPA content
    - Script tag with type="module" loading src/app.js

    main.css must define CSS variables (from 01-RESEARCH.md):
    - Colors: --color-primary (#58cc02), --color-primary-dark, --color-secondary (#1cb0f6), --color-accent (#ff9600), --color-danger (#ea2b2b)
    - Typography: --font-family (system fonts), --font-size-base (16px), --font-size-lg (20px), --font-size-xl (28px)
    - Spacing: 8px grid system (--space-xs through --space-xl)
    - Touch targets: --touch-target-min (48px)
    - Basic body reset: margin 0, font-family, background color

    layout.css must include:
    - .container class with responsive max-width
    - Mobile-first media queries for 600px (tablet) and 1200px (desktop)
    - Basic flex and grid utilities

    components.css must include:
    - .btn base class with 48x48px minimum touch target
    - Button states (hover, active, focus)
    - prefers-reduced-motion media query to disable transitions
  </action>
  <verify>
    - Open index.html in browser (file:// or live-server)
    - No console errors
    - Page shows empty #app div (white page is correct)
    - Inspect CSS variables in dev tools (:root should show all custom properties)
  </verify>
  <done>
    index.html loads without errors, CSS variables are defined, .nojekyll exists, folder structure created
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement hash-based Router service</name>
  <files>
    src/services/router.js
    src/app.js
  </files>
  <action>
    Create src/services/router.js implementing the Router class from 01-RESEARCH.md:

    Router class must:
    - Accept routes object in constructor (path -> view function mapping)
    - Listen to 'hashchange' event for navigation
    - Listen to 'DOMContentLoaded' for initial route handling
    - Parse hash from window.location.hash (strip leading #)
    - Support route parameters (e.g., /lesson/:id) - extract :id as params object
    - Handle default route (empty hash -> '/')
    - Handle 404 for unknown routes
    - Clear #app container before rendering new view
    - Call view function with (container, params) arguments
    - Export navigate(path) method for programmatic navigation

    Route parameter parsing:
    - Match /lesson/:id pattern against /lesson/1
    - Return { id: '1' } in params object

    Create src/app.js as application entry point:
    - Import Router from './services/router.js'
    - Define routes object with:
      - '/': placeholder home view (renders "Home - KI und ich")
      - '/lesson/:id': placeholder lesson view (renders "Lektion {id}")
      - '/quiz/:id': placeholder quiz view (renders "Quiz {id}")
      - '/404': not found view
    - Initialize router with routes
    - Add global error handler (window.onerror) showing user-friendly message

    Do NOT use complex regex - simple string splitting for parameter extraction is sufficient.
    Do NOT add any dependencies - pure vanilla JavaScript with ES6 modules.
  </action>
  <verify>
    - Open index.html in browser with live-server (needed for ES6 modules)
    - Page shows "Home - KI und ich"
    - Change URL to /#/lesson/1 - shows "Lektion 1"
    - Change URL to /#/quiz/3 - shows "Quiz 3"
    - Change URL to /#/unknown - shows 404 page
    - Browser back button works correctly
  </verify>
  <done>
    Router handles hash changes, extracts route params, renders correct views, navigation works
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement StateManager service for LocalStorage persistence</name>
  <files>
    src/services/state.js
  </files>
  <action>
    Create src/services/state.js implementing StateManager class from 01-RESEARCH.md:

    StateManager class must:
    - Accept storageKey in constructor (default: 'ki-und-ich-state')
    - Load state from localStorage on construction (with try/catch for parse errors)
    - Provide getDefaultState() returning initial app state:
      {
        currentLesson: 0,
        completedLessons: [],
        quizScores: {},
        lastVisited: null
      }
    - Provide save() method writing JSON to localStorage (with try/catch)
    - Provide get(key) method to retrieve state property
    - Provide set(key, value) method to update state property
    - Provide enableAutoSave() method that saves on 'beforeunload' event
    - Provide reset() method to clear state and restore defaults (for testing)

    IMPORTANT for DSGVO compliance:
    - Store ONLY app state (lesson progress, quiz scores)
    - Do NOT store any personal data (names, emails, identifiers)
    - Add comment in code explaining DSGVO compliance approach

    Update src/app.js to:
    - Import StateManager
    - Initialize state manager
    - Enable auto-save
    - Make state available to views (pass as second argument to router or via global)
  </action>
  <verify>
    - Open browser dev tools -> Application -> Local Storage
    - Refresh page - 'ki-und-ich-state' key should appear
    - Value should be valid JSON with default state structure
    - Navigate to /#/lesson/1, refresh - state persists
    - Clear localStorage, refresh - state recreated with defaults
  </verify>
  <done>
    StateManager loads/saves to localStorage, auto-saves on unload, no personal data stored
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Run `live-server` in project root (or use VS Code Live Server)
2. Open http://127.0.0.1:8080 in browser
3. Verify no console errors
4. Navigate using URL hash changes
5. Confirm localStorage contains state
6. Check CSS variables in dev tools
</verification>

<success_criteria>
- [ ] index.html loads with proper viewport meta tag
- [ ] CSS variables define complete design system
- [ ] Router handles all hash-based navigation
- [ ] Route parameters correctly extracted
- [ ] StateManager persists to localStorage
- [ ] No personal data stored (DSGVO-compliant)
- [ ] All ES6 modules import correctly
- [ ] Zero console errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-01-SUMMARY.md`
</output>
