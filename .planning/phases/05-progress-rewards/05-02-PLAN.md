---
phase: 05-progress-rewards
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - assets/styles/components.css
  - src/components/celebration.js
autonomous: true

must_haves:
  truths:
    - "User sees confetti animation when passing quiz (score >= 3)"
    - "Confetti respects prefers-reduced-motion preference"
    - "Completed lessons show animated badge on home screen"
  artifacts:
    - path: "index.html"
      provides: "canvas-confetti CDN script tag"
      contains: "canvas-confetti"
    - path: "assets/styles/components.css"
      provides: "Enhanced completion badge styles with animation"
      contains: "badge-pop"
    - path: "src/components/celebration.js"
      provides: "Celebration utilities for quiz success"
      exports: ["triggerConfetti", "celebrateQuizPass"]
  key_links:
    - from: "src/components/celebration.js"
      to: "window.confetti"
      via: "CDN global"
      pattern: "confetti\\("
---

<objective>
Add confetti celebration animation and enhance completion badge visuals

Purpose: Create visual celebrations that reinforce positive learning moments for children
Output: canvas-confetti integration and polished completion badges with animations
</objective>

<execution_context>
@C:\Users\Furby\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Furby\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-progress-rewards/RESEARCH.md
@index.html
@assets/styles/components.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add canvas-confetti CDN to index.html</name>
  <files>index.html</files>
  <action>
Add the canvas-confetti library via CDN before the closing </body> tag, but before the app.js module script:

```html
<!-- Before </body>, after all CSS links, before app.js -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.4/dist/confetti.browser.min.js"></script>
<script type="module" src="src/app.js"></script>
</body>
```

The order matters: confetti must load before app.js so window.confetti is available when celebration.js imports.

Note: canvas-confetti is only 3KB gzipped and has built-in disableForReducedMotion support.
  </action>
  <verify>View page source or check Network tab shows confetti.browser.min.js loading</verify>
  <done>canvas-confetti script tag added to index.html before app.js</done>
</task>

<task type="auto">
  <name>Task 2: Enhance completion badge CSS with pop animation</name>
  <files>assets/styles/components.css</files>
  <action>
Update the .lesson-status styles in components.css to add the pop animation from RESEARCH.md.

Find existing .lesson-status rule (or add if not present) and enhance:

```css
/* Completion badge on lesson cards */
.lesson-status {
    position: absolute;
    top: var(--space-sm);
    right: var(--space-sm);
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-primary);
    color: white;
    border-radius: var(--radius-full);
    font-size: var(--font-size-lg);
    font-weight: bold;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);

    /* Entrance animation */
    animation: badge-pop 0.4s ease-out;
}

@keyframes badge-pop {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    70% {
        transform: scale(1.2);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
    .lesson-status {
        animation: none;
    }
}

/* Enhanced completed card styling */
.lesson-card--completed {
    border-color: var(--color-primary);
    background: linear-gradient(135deg, rgba(88, 204, 2, 0.1) 0%, rgba(255, 255, 255, 1) 100%);
}

.lesson-card--completed:hover {
    border-color: var(--color-primary-dark);
}
```

If .lesson-status already exists with simpler styles, replace/merge with the enhanced version.
  </action>
  <verify>In browser, complete a lesson and return to home - badge should pop with animation</verify>
  <done>Completion badges have animated pop entrance and enhanced styling</done>
</task>

<task type="auto">
  <name>Task 3: Create celebration.js with confetti utilities</name>
  <files>src/components/celebration.js</files>
  <action>
Create a celebration module that wraps canvas-confetti with app-specific defaults:

```javascript
/**
 * Celebration Utilities
 *
 * Provides confetti and visual celebration effects.
 * Uses canvas-confetti library (loaded via CDN).
 * Respects prefers-reduced-motion preference.
 */

/**
 * Check if user prefers reduced motion
 */
function prefersReducedMotion() {
    return window.matchMedia('(prefers-reduced-motion: reduce)').matches;
}

/**
 * Trigger a confetti burst with custom options
 * @param {Object} options - canvas-confetti options override
 */
export function triggerConfetti(options = {}) {
    // Skip if reduced motion preferred
    if (prefersReducedMotion()) {
        return;
    }

    // Check if confetti is available (CDN loaded)
    if (typeof window.confetti !== 'function') {
        console.warn('Celebration: confetti library not loaded');
        return;
    }

    // Default options with app colors
    const defaults = {
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 },
        colors: ['#58CC02', '#1FA3F3', '#8B5CF6', '#F59E0B', '#FF6B6B'],
        disableForReducedMotion: true
    };

    window.confetti({
        ...defaults,
        ...options
    });
}

/**
 * Celebrate quiz pass with multi-burst confetti
 * Creates a more dramatic effect for quiz completion
 */
export function celebrateQuizPass() {
    if (prefersReducedMotion()) {
        return;
    }

    // First burst - center
    triggerConfetti({
        particleCount: 80,
        spread: 60,
        origin: { x: 0.5, y: 0.6 }
    });

    // Second burst - left side (delayed)
    setTimeout(() => {
        triggerConfetti({
            particleCount: 40,
            spread: 55,
            origin: { x: 0.3, y: 0.65 }
        });
    }, 150);

    // Third burst - right side (delayed)
    setTimeout(() => {
        triggerConfetti({
            particleCount: 40,
            spread: 55,
            origin: { x: 0.7, y: 0.65 }
        });
    }, 300);
}

/**
 * Celebrate perfect score (5/5) with extra flair
 */
export function celebratePerfectScore() {
    if (prefersReducedMotion()) {
        return;
    }

    // Confetti rain from top
    triggerConfetti({
        particleCount: 150,
        spread: 180,
        origin: { y: 0 },
        gravity: 0.8,
        scalar: 1.2
    });

    // Side bursts
    setTimeout(() => {
        triggerConfetti({
            particleCount: 50,
            angle: 60,
            spread: 45,
            origin: { x: 0, y: 0.6 }
        });
        triggerConfetti({
            particleCount: 50,
            angle: 120,
            spread: 45,
            origin: { x: 1, y: 0.6 }
        });
    }, 200);
}

export default { triggerConfetti, celebrateQuizPass, celebratePerfectScore };
```

Colors explanation:
- #58CC02 (Duolingo green) - primary success
- #1FA3F3 (blue) - secondary accent
- #8B5CF6 (purple) - Kiki's color
- #F59E0B (orange) - warm accent
- #FF6B6B (coral) - playful accent
  </action>
  <verify>
In browser console after loading page:
1. import { triggerConfetti } from './src/components/celebration.js'
2. triggerConfetti()
3. Confetti should burst from center
  </verify>
  <done>celebration.js exports triggerConfetti, celebrateQuizPass, celebratePerfectScore functions</done>
</task>

</tasks>

<verification>
1. index.html includes canvas-confetti CDN script before app.js
2. components.css has .lesson-status with @keyframes badge-pop animation
3. src/components/celebration.js exports 3 celebration functions
4. All animations respect prefers-reduced-motion
</verification>

<success_criteria>
- canvas-confetti loads without errors (check Network tab)
- triggerConfetti() produces visible confetti burst
- celebrateQuizPass() creates multi-burst effect
- Completion badges animate when appearing
- Setting prefers-reduced-motion: reduce disables all animations
</success_criteria>

<output>
After completion, create `.planning/phases/05-progress-rewards/05-02-SUMMARY.md`
</output>
